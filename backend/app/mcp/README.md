# KB MCP Server

MCP (Model Context Protocol) —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π –ø—Ä–æ–µ–∫—Ç–∞ 3dtoday.

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

KB MCP Server –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π —á–µ—Ä–µ–∑ –ø—Ä–æ—Ç–æ–∫–æ–ª MCP. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å LangGraph –∞–≥–µ–Ω—Ç–æ–≤ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ KB.

## üöÄ –ó–∞–ø—É—Å–∫

### –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ (stdio transport)

```bash
cd backend/app/mcp
python3 kb_mcp_server.py
```

–°–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ stdio transport –∏ –≥–æ—Ç–æ–≤ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –æ—Ç MCP –∫–ª–∏–µ–Ω—Ç–æ–≤.

## üõ†Ô∏è –î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### 1. `search_kb_articles`

–ü–æ–∏—Å–∫ —Å—Ç–∞—Ç–µ–π –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π –ø–æ –∑–∞–ø—Ä–æ—Å—É —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `query` (str): –¢–µ–∫—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞
- `problem_type` (str, optional): –¢–∏–ø –ø—Ä–æ–±–ª–µ–º—ã (stringing, warping, etc.)
- `printer_model` (str, optional): –ú–æ–¥–µ–ª—å –ø—Ä–∏–Ω—Ç–µ—Ä–∞ (Ender-3, etc.)
- `material` (str, optional): –ú–∞—Ç–µ—Ä–∏–∞–ª (PLA, PETG, etc.)
- `limit` (int, default=5): –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- –°–ø–∏—Å–æ–∫ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ –∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å—é

### 2. `get_article_by_id`

–ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–π —Å—Ç–∞—Ç—å–∏ –ø–æ ID.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `article_id` (str): ID —Å—Ç–∞—Ç—å–∏ –≤ KB

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç–∞—Ç—å–µ –∏–ª–∏ –æ—à–∏–±–∫–∞, –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞

### 3. `get_kb_statistics`

–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π.

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–∞—Ç–µ–π, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –≤–µ–∫—Ç–æ—Ä–æ–≤

## üìö –†–µ—Å—É—Ä—Å—ã

### `kb://statistics`

–¢–µ–∫—Å—Ç–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ KB –≤ —É–¥–æ–±–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ.

## üí¨ –ü—Ä–æ–º–ø—Ç—ã

### `diagnostic_prompt`

–ü—Ä–æ–º–ø—Ç –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º—ã 3D-–ø–µ—á–∞—Ç–∏.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `user_query` (str): –ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `printer_model` (str, optional): –ú–æ–¥–µ–ª—å –ø—Ä–∏–Ω—Ç–µ—Ä–∞
- `material` (str, optional): –ú–∞—Ç–µ—Ä–∏–∞–ª
- `has_image` (bool): –ï—Å—Ç—å –ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–µ—Ñ–µ–∫—Ç–∞

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É:

```bash
python3 backend/app/mcp/test_mcp_server.py
```

## üìñ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å LangGraph

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ Diagnostic MCP Client:

```python
from mcp import ClientSession, StdioServerParameters
from mcp.client.stdio import stdio_client
from langchain_mcp_adapters.tools import load_mcp_tools

server_params = StdioServerParameters(
    command="python3",
    args=["backend/app/mcp/kb_mcp_server.py"]
)

async with stdio_client(server_params) as (read, write):
    async with ClientSession(read, write) as session:
        await session.initialize()
        
        # –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
        tools = await load_mcp_tools(session)
        
        # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ LangGraph –∞–≥–µ–Ω—Ç–µ
        # ...
```

## üîß –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- `mcp` - Model Context Protocol
- `sentence-transformers` - –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
- `qdrant-client` - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –ë–î

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –°–µ—Ä–≤–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç CPU –¥–ª—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–µ—Å–ª–∏ CUDA –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞)
- –ú–æ–¥–µ–ª—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ (–º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Ä–µ–º—è)
- –í—Å–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç async –º–µ—Ç–æ–¥—ã –≤–Ω—É—Ç—Ä–∏



