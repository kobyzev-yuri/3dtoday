# –ê–≥–µ–Ω—Ç-–∫—É—Ä–∞—Ç–æ—Ä KB (KB Curator Agent)

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞

**KB Curator Agent** ‚Äî –∞–≥–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ü–µ–Ω–∑—É—Ä–∏—Ä—É–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –∏–∑–≤–ª–µ—á–µ–Ω–Ω—É—é –ø–∞—Ä—Å–µ—Ä–æ–º, –∏ –≥–æ—Ç–æ–≤–∏—Ç Q/A –ø–∞—Ä—ã –¥–ª—è KB.

**–ó–∞–¥–∞—á–∏:**
1. ‚úÖ **–¶–µ–Ω–∑—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –∏ –∫–∞—á–µ—Å—Ç–≤–æ
2. ‚úÖ **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –º—É—Å–æ—Ä–∞** ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
3. ‚úÖ **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Q/A** ‚Äî —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ–ø—Ä–æ—Å-–æ—Ç–≤–µ—Ç –ø–∞—Ä –∏–∑ —Å—Ç–∞—Ç–µ–π
4. ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ —É–ª—É—á—à–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

---

## üìã –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∞–≥–µ–Ω—Ç–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Parser (–∏–∑–≤–ª–µ–∫–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é)          ‚îÇ
‚îÇ  - HTML ‚Üí —Ç–µ–∫—Å—Ç                          ‚îÇ
‚îÇ  - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  KB Curator Agent (—Ü–µ–Ω–∑—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ)      ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Content Validator                   ‚îÇ
‚îÇ  ‚îÇ   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏            ‚îÇ
‚îÇ  ‚îÇ   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞                 ‚îÇ
‚îÇ  ‚îÇ   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –º—É—Å–æ—Ä–∞                 ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Metadata Extractor                  ‚îÇ
‚îÇ  ‚îÇ   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö      ‚îÇ
‚îÇ  ‚îÇ     –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö                         ‚îÇ
‚îÇ  ‚îÇ   - –í–∞–ª–∏–¥–∞—Ü–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö              ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ QA Generator                        ‚îÇ
‚îÇ  ‚îÇ   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Q/A –ø–∞—Ä –∏–∑ —Å—Ç–∞—Ç—å–∏       ‚îÇ
‚îÇ  ‚îÇ   - –í–∞–ª–∏–¥–∞—Ü–∏—è Q/A                     ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ KB Formatter                        ‚îÇ
‚îÇ      - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è KB             ‚îÇ
‚îÇ      - –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  KB (Qdrant)                            ‚îÇ
‚îÇ  - –°—Ç–∞—Ç—å–∏                               ‚îÇ
‚îÇ  - Q/A –ø–∞—Ä—ã                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîç –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∞–≥–µ–Ω—Ç–∞

### 1. Content Validator (–í–∞–ª–∏–¥–∞—Ç–æ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ –∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∏–∑–≤–ª–µ—á–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

```python
class ContentValidator:
    """–í–∞–ª–∏–¥–∞—Ç–æ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è KB"""
    
    def __init__(self, llm_client):
        self.llm = llm_client
        self.min_relevance_score = 0.7
        self.min_content_length = 200  # –ú–∏–Ω–∏–º—É–º —Å–∏–º–≤–æ–ª–æ–≤
    
    async def validate_content(self, article_content: dict) -> dict:
        """
        –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å—Ç–∞—Ç—å–∏
        
        Args:
            article_content: {
                "url": str,
                "title": str,
                "content": str,
                "section": str,
                "date": str
            }
        
        Returns:
            {
                "valid": bool,
                "relevance_score": float,
                "quality_score": float,
                "issues": List[str],
                "recommendations": List[str]
            }
        """
        
        # 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        if len(article_content["content"]) < self.min_content_length:
            return {
                "valid": False,
                "relevance_score": 0.0,
                "quality_score": 0.0,
                "issues": ["–ö–æ–Ω—Ç–µ–Ω—Ç —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π"],
                "recommendations": []
            }
        
        # 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ LLM
        relevance_check = await self._check_relevance(article_content)
        
        # 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —á–µ—Ä–µ–∑ LLM
        quality_check = await self._check_quality(article_content)
        
        # 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π
        has_solutions = await self._check_solutions(article_content)
        
        # 5. –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞
        is_valid = (
            relevance_check["relevance_score"] >= self.min_relevance_score and
            quality_check["quality_score"] >= 0.6 and
            has_solutions["has_solutions"]
        )
        
        return {
            "valid": is_valid,
            "relevance_score": relevance_check["relevance_score"],
            "quality_score": quality_check["quality_score"],
            "has_solutions": has_solutions["has_solutions"],
            "issues": relevance_check["issues"] + quality_check["issues"],
            "recommendations": relevance_check["recommendations"] + quality_check["recommendations"]
        }
    
    async def _check_relevance(self, article_content: dict) -> dict:
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ LLM"""
        
        prompt = f"""
–ü—Ä–æ–≤–µ—Ä—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å —Å—Ç–∞—Ç—å–∏ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º 3D-–ø–µ—á–∞—Ç–∏.

–°–¢–ê–¢–¨–Ø:
–ó–∞–≥–æ–ª–æ–≤–æ–∫: {article_content['title']}
–†–∞–∑–¥–µ–ª: {article_content['section']}
–ö–æ–Ω—Ç–µ–Ω—Ç: {article_content['content'][:2000]}

–ö–†–ò–¢–ï–†–ò–ò –†–ï–õ–ï–í–ê–ù–¢–ù–û–°–¢–ò:
1. –°–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ —Å—Ç–∞—Ç—å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö 3D-–ø–µ—á–∞—Ç–∏?
2. –ï—Å—Ç—å –ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏?
3. –£–ø–æ–º–∏–Ω–∞—é—Ç—Å—è –ª–∏ –º–æ–¥–µ–ª–∏ –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤, –º–∞—Ç–µ—Ä–∏–∞–ª—ã, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã?
4. –Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ–ª–µ–∑–Ω–æ–π –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏?

–í–µ—Ä–Ω–∏ JSON:
{{
    "relevance_score": 0.0-1.0,
    "is_relevant": true/false,
    "issues": ["–ø—Ä–æ–±–ª–µ–º–∞1", "–ø—Ä–æ–±–ª–µ–º–∞2"],
    "recommendations": ["—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è1"]
}}
"""
        
        response = await self.llm.generate(prompt)
        return json.loads(response)
    
    async def _check_quality(self, article_content: dict) -> dict:
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞"""
        
        prompt = f"""
–û—Ü–µ–Ω–∏ –∫–∞—á–µ—Å—Ç–≤–æ —Å—Ç–∞—Ç—å–∏ –¥–ª—è –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π.

–°–¢–ê–¢–¨–Ø:
{article_content['content'][:2000]}

–ö–†–ò–¢–ï–†–ò–ò –ö–ê–ß–ï–°–¢–í–ê:
1. –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å (–µ—Å—Ç—å –ª–∏ —á–µ—Ç–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞?)
2. –ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ—Å—Ç—å (–µ—Å—Ç—å –ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∑–Ω–∞—á–µ–Ω–∏—è?)
3. –ü–æ–ª–Ω–æ—Ç–∞ (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏?)
4. –ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å (–Ω–µ —É—Å—Ç–∞—Ä–µ–ª–∞ –ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è?)

–í–µ—Ä–Ω–∏ JSON:
{{
    "quality_score": 0.0-1.0,
    "issues": ["–ø—Ä–æ–±–ª–µ–º–∞1"],
    "recommendations": ["—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è1"]
}}
"""
        
        response = await self.llm.generate(prompt)
        return json.loads(response)
    
    async def _check_solutions(self, article_content: dict) -> dict:
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π"""
        
        # –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
        content_lower = article_content["content"].lower()
        
        solution_keywords = [
            "—É–≤–µ–ª–∏—á—å—Ç–µ", "—É–º–µ–Ω—å—à–∏—Ç–µ", "—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ", "–Ω–∞—Å—Ç—Ä–æ–π—Ç–µ",
            "—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞", "—Å–∫–æ—Ä–æ—Å—Ç—å", "retraction", "fan",
            "–º–º", "¬∞c", "mm/s", "–ø—Ä–æ—Ü–µ–Ω—Ç"
        ]
        
        has_keywords = sum(1 for kw in solution_keywords if kw in content_lower)
        has_solutions = has_keywords >= 3  # –ú–∏–Ω–∏–º—É–º 3 –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤–∞
        
        return {
            "has_solutions": has_solutions,
            "keywords_found": has_keywords
        }
```

### 2. Metadata Extractor (–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

```python
class MetadataExtractor:
    """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏–∑ —Å—Ç–∞—Ç—å–∏"""
    
    def __init__(self, llm_client):
        self.llm = llm_client
    
    async def extract_metadata(self, article_content: dict) -> dict:
        """
        –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
        
        Returns:
            {
                "problem_type": str,
                "printer_models": List[str],
                "materials": List[str],
                "symptoms": List[str],
                "solutions": List[Dict],
                "print_stage": List[str],
                "confidence": float
            }
        """
        
        prompt = f"""
–ò–∑–≤–ª–µ–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏–∑ —Å—Ç–∞—Ç—å–∏ –æ 3D-–ø–µ—á–∞—Ç–∏.

–°–¢–ê–¢–¨–Ø:
–ó–∞–≥–æ–ª–æ–≤–æ–∫: {article_content['title']}
–ö–æ–Ω—Ç–µ–Ω—Ç: {article_content['content'][:3000]}

–ò–ó–í–õ–ï–ö–ò:
1. –¢–∏–ø –ø—Ä–æ–±–ª–µ–º—ã (problem_type): stringing, warping, layer_separation, etc.
2. –ú–æ–¥–µ–ª–∏ –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤ (printer_models): Ender-3, Anycubic Kobra, etc.
3. –ú–∞—Ç–µ—Ä–∏–∞–ª—ã (materials): PLA, PETG, ABS, etc.
4. –°–∏–º–ø—Ç–æ–º—ã (symptoms): ["–Ω–∏—Ç–æ—á–∫–∏", "–æ—Ç—Å–ª–æ–µ–Ω–∏–µ", ...]
5. –†–µ—à–µ–Ω–∏—è (solutions): [{{"parameter": "retraction_length", "value": 6, "unit": "mm"}}]
6. –≠—Ç–∞–ø –ø–µ—á–∞—Ç–∏ (print_stage): first_layer, infill, etc.

–í–ê–ñ–ù–û:
- –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ —Å—Ç–∞—Ç—å–∏
- –ù–µ –≤—ã–¥—É–º—ã–≤–∞–π, –µ—Å–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–µ—Ç - —É–∫–∞–∂–∏ null –∏–ª–∏ []
- –ë—É–¥—å —Ç–æ—á–Ω—ã–º –≤ –∑–Ω–∞—á–µ–Ω–∏—è—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

–í–µ—Ä–Ω–∏ JSON:
{{
    "problem_type": "stringing" –∏–ª–∏ null,
    "printer_models": ["Ender-3"] –∏–ª–∏ [],
    "materials": ["PLA"] –∏–ª–∏ [],
    "symptoms": ["–Ω–∏—Ç–æ—á–∫–∏"] –∏–ª–∏ [],
    "solutions": [
        {{
            "parameter": "retraction_length",
            "value": 6,
            "unit": "mm",
            "description": "–£–≤–µ–ª–∏—á—å—Ç–µ retraction –¥–æ 6 –º–º"
        }}
    ] –∏–ª–∏ [],
    "print_stage": ["first_layer"] –∏–ª–∏ [],
    "confidence": 0.0-1.0
}}
"""
        
        response = await self.llm.generate(prompt)
        metadata = json.loads(response)
        
        # –í–∞–ª–∏–¥–∞—Ü–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
        validated_metadata = self._validate_metadata(metadata)
        
        return validated_metadata
    
    def _validate_metadata(self, metadata: dict) -> dict:
        """–í–∞–ª–∏–¥–∞—Ü–∏—è –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö"""
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
        if metadata.get("problem_type") and not isinstance(metadata["problem_type"], str):
            metadata["problem_type"] = None
        
        if metadata.get("printer_models") and not isinstance(metadata["printer_models"], list):
            metadata["printer_models"] = []
        
        if metadata.get("materials") and not isinstance(metadata["materials"], list):
            metadata["materials"] = []
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ solutions
        if metadata.get("solutions"):
            validated_solutions = []
            for sol in metadata["solutions"]:
                if isinstance(sol, dict) and "parameter" in sol and "value" in sol:
                    validated_solutions.append(sol)
            metadata["solutions"] = validated_solutions
        
        return metadata
```

### 3. QA Generator (–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä Q/A)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ–ø—Ä–æ—Å-–æ—Ç–≤–µ—Ç –ø–∞—Ä –∏–∑ —Å—Ç–∞—Ç–µ–π

```python
class QAGenerator:
    """–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä Q/A –ø–∞—Ä –∏–∑ —Å—Ç–∞—Ç–µ–π"""
    
    def __init__(self, llm_client):
        self.llm = llm_client
    
    async def generate_qa_pairs(self, article: dict, metadata: dict) -> List[dict]:
        """
        –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Q/A –ø–∞—Ä –∏–∑ —Å—Ç–∞—Ç—å–∏
        
        Args:
            article: {
                "title": str,
                "content": str,
                "url": str
            }
            metadata: {
                "problem_type": str,
                "printer_models": List[str],
                "materials": List[str],
                "solutions": List[Dict]
            }
        
        Returns:
            List[{
                "question": str,
                "answer": str,
                "problem_type": str,
                "printer_models": List[str],
                "materials": List[str],
                "source_url": str,
                "confidence": float
            }]
        """
        
        prompt = f"""
–°–æ–∑–¥–∞–π 3-5 –≤–æ–ø—Ä–æ—Å-–æ—Ç–≤–µ—Ç –ø–∞—Ä –¥–ª—è –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞—Ç—å–∏.

–°–¢–ê–¢–¨–Ø:
–ó–∞–≥–æ–ª–æ–≤–æ–∫: {article['title']}
–ü—Ä–æ–±–ª–µ–º–∞: {metadata.get('problem_type', '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ')}
–ü—Ä–∏–Ω—Ç–µ—Ä—ã: {', '.join(metadata.get('printer_models', []))}
–ú–∞—Ç–µ—Ä–∏–∞–ª—ã: {', '.join(metadata.get('materials', []))}

–°–û–î–ï–†–ñ–ê–ù–ò–ï:
{article['content'][:2000]}

–†–ï–®–ï–ù–ò–Ø:
{json.dumps(metadata.get('solutions', []), ensure_ascii=False, indent=2)}

–¢–†–ï–ë–û–í–ê–ù–ò–Ø:
1. –í–æ–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º–∏ (–∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–ø—Ä–∞—à–∏–≤–∞—é—Ç)
2. –û—Ç–≤–µ—Ç—ã –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –∏–∑ —Å—Ç–∞—Ç—å–∏
3. –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ —Å—Ç–∞—Ç—å–∏
4. –í–æ–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–∑–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏

–§–û–†–ú–ê–¢ –í–û–ü–†–û–°–û–í:
- –ü—Ä–æ—Å—Ç—ã–µ: "–ö–∞–∫ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å stringing –Ω–∞ Ender-3?"
- –° –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º: "–£ –º–µ–Ω—è stringing –ø—Ä–∏ –ø–µ—á–∞—Ç–∏ PLA –Ω–∞ Ender-3, —á—Ç–æ –¥–µ–ª–∞—Ç—å?"
- –° —Å–∏–º–ø—Ç–æ–º–∞–º–∏: "–ü–µ—á–∞—Ç–∞—é PLA, –≤–µ–∑–¥–µ –Ω–∏—Ç–æ—á–∫–∏ –º–µ–∂–¥—É –¥–µ—Ç–∞–ª—è–º–∏, –∫–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å?"

–í–µ—Ä–Ω–∏ JSON:
{{
    "qa_pairs": [
        {{
            "question": "–ö–∞–∫ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å stringing –Ω–∞ Ender-3?",
            "answer": "–£–≤–µ–ª–∏—á—å—Ç–µ retraction –¥–æ 6 –º–º, —Å–∫–æ—Ä–æ—Å—Ç—å 45 –º–º/—Å...",
            "problem_type": "stringing",
            "printer_models": ["Ender-3"],
            "materials": ["PLA"],
            "confidence": 0.9
        }}
    ]
}}
"""
        
        response = await self.llm.generate(prompt)
        result = json.loads(response)
        
        # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ source_url –∫ –∫–∞–∂–¥–æ–π –ø–∞—Ä–µ
        qa_pairs = result.get("qa_pairs", [])
        for qa in qa_pairs:
            qa["source_url"] = article["url"]
        
        # –í–∞–ª–∏–¥–∞—Ü–∏—è Q/A –ø–∞—Ä
        validated_qa = self._validate_qa_pairs(qa_pairs)
        
        return validated_qa
    
    def _validate_qa_pairs(self, qa_pairs: List[dict]) -> List[dict]:
        """–í–∞–ª–∏–¥–∞—Ü–∏—è Q/A –ø–∞—Ä"""
        
        validated = []
        for qa in qa_pairs:
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
            if not qa.get("question") or not qa.get("answer"):
                continue
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã
            if len(qa["question"]) < 10 or len(qa["answer"]) < 50:
                continue
            
            validated.append(qa)
        
        return validated
```

### 4. KB Formatter (–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è KB)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –≤ KB

```python
class KBFormatter:
    """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è KB"""
    
    def format_article(self, article: dict, metadata: dict, validation: dict) -> dict:
        """
        –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏ –¥–ª—è KB
        
        Returns:
            {
                "article_id": str,
                "url": str,
                "title": str,
                "content": str,
                "section": str,
                "date": str,
                "relevance_score": float,
                "problem_type": str,
                "printer_models": List[str],
                "materials": List[str],
                "symptoms": List[str],
                "solutions": List[Dict],
                "print_stage": List[str],
                "related_problems": List[str],
                "last_updated": str,
                "usage_count": 0
            }
        """
        
        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è article_id
        article_id = self._generate_article_id(article, metadata)
        
        # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
        formatted = {
            "article_id": article_id,
            "url": article["url"],
            "title": article["title"],
            "content": article["content"],
            "section": article.get("section", "unknown"),
            "date": article.get("date", datetime.now().isoformat()),
            "relevance_score": validation.get("relevance_score", 0.0),
            "problem_type": metadata.get("problem_type"),
            "printer_models": metadata.get("printer_models", []),
            "materials": metadata.get("materials", []),
            "symptoms": metadata.get("symptoms", []),
            "solutions": metadata.get("solutions", []),
            "print_stage": metadata.get("print_stage", []),
            "related_problems": metadata.get("related_problems", []),
            "last_updated": datetime.now().isoformat(),
            "usage_count": 0
        }
        
        return formatted
    
    def format_qa_pair(self, qa: dict) -> dict:
        """
        –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Q/A –ø–∞—Ä—ã –¥–ª—è KB
        
        Returns:
            {
                "qa_id": str,
                "question": str,
                "answer": str,
                "problem_type": str,
                "printer_models": List[str],
                "materials": List[str],
                "source_url": str,
                "confidence": float,
                "created_at": str
            }
        """
        
        qa_id = f"qa_{hash(qa['question'])}_{datetime.now().timestamp()}"
        
        return {
            "qa_id": qa_id,
            "question": qa["question"],
            "answer": qa["answer"],
            "problem_type": qa.get("problem_type"),
            "printer_models": qa.get("printer_models", []),
            "materials": qa.get("materials", []),
            "source_url": qa.get("source_url"),
            "confidence": qa.get("confidence", 0.0),
            "created_at": datetime.now().isoformat()
        }
    
    def _generate_article_id(self, article: dict, metadata: dict) -> str:
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ID —Å—Ç–∞—Ç—å–∏"""
        
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º problem_type + –ø–µ—Ä–≤—ã–µ —Å–ª–æ–≤–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞
        problem_type = metadata.get("problem_type", "unknown")
        title_words = article["title"].lower().split()[:3]
        title_slug = "_".join(title_words)
        
        return f"{problem_type}_{title_slug}"
```

---

## ü§ñ –ü–æ–ª–Ω—ã–π –∞–≥–µ–Ω—Ç KB Curator

```python
class KBCuratorAgent:
    """–ê–≥–µ–Ω—Ç-–∫—É—Ä–∞—Ç–æ—Ä –¥–ª—è —Ü–µ–Ω–∑—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è KB"""
    
    def __init__(self, llm_client, vector_db):
        self.content_validator = ContentValidator(llm_client)
        self.metadata_extractor = MetadataExtractor(llm_client)
        self.qa_generator = QAGenerator(llm_client)
        self.kb_formatter = KBFormatter()
        self.vector_db = vector_db
    
    async def process_article(self, parsed_article: dict) -> dict:
        """
        –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç—å–∏: —Ü–µ–Ω–∑—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–ª—è KB
        
        Args:
            parsed_article: {
                "url": str,
                "title": str,
                "content": str,
                "section": str,
                "date": str
            }
        
        Returns:
            {
                "accepted": bool,
                "article": dict (–µ—Å–ª–∏ accepted=True),
                "qa_pairs": List[dict] (–µ—Å–ª–∏ accepted=True),
                "rejection_reason": str (–µ—Å–ª–∏ accepted=False),
                "validation": dict
            }
        """
        
        # 1. –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        validation = await self.content_validator.validate_content(parsed_article)
        
        if not validation["valid"]:
            return {
                "accepted": False,
                "rejection_reason": "; ".join(validation["issues"]),
                "validation": validation
            }
        
        # 2. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
        metadata = await self.metadata_extractor.extract_metadata(parsed_article)
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è problem_type (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ)
        if not metadata.get("problem_type"):
            return {
                "accepted": False,
                "rejection_reason": "–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø –ø—Ä–æ–±–ª–µ–º—ã",
                "validation": validation,
                "metadata": metadata
            }
        
        # 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Q/A –ø–∞—Ä
        qa_pairs = await self.qa_generator.generate_qa_pairs(parsed_article, metadata)
        
        if not qa_pairs:
            return {
                "accepted": False,
                "rejection_reason": "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å Q/A –ø–∞—Ä—ã",
                "validation": validation,
                "metadata": metadata
            }
        
        # 4. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è KB
        formatted_article = self.kb_formatter.format_article(
            parsed_article, metadata, validation
        )
        
        formatted_qa_pairs = [
            self.kb_formatter.format_qa_pair(qa) for qa in qa_pairs
        ]
        
        return {
            "accepted": True,
            "article": formatted_article,
            "qa_pairs": formatted_qa_pairs,
            "validation": validation,
            "metadata": metadata
        }
    
    async def index_to_kb(self, processed_result: dict) -> bool:
        """
        –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–π —Å—Ç–∞—Ç—å–∏ –≤ KB
        
        Returns:
            True –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ, False –µ—Å–ª–∏ –æ—à–∏–±–∫–∞
        """
        
        if not processed_result["accepted"]:
            return False
        
        try:
            # –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Å—Ç–∞—Ç—å–∏
            article = processed_result["article"]
            await self.vector_db.add_article(article)
            
            # –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è Q/A –ø–∞—Ä
            for qa in processed_result["qa_pairs"]:
                await self.vector_db.add_qa_pair(qa)
            
            return True
        
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –≤ KB: {e}")
            return False
```

---

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–∞—Ä—Å–µ—Ä–æ–º

**–ü–æ–ª–Ω—ã–π pipeline:**

```python
async def parse_and_curate_article(url: str) -> dict:
    """–ü–æ–ª–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å: –ø–∞—Ä—Å–∏–Ω–≥ ‚Üí —Ü–µ–Ω–∑—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è"""
    
    # 1. –ü–∞—Ä—Å–∏–Ω–≥
    parser = ArticleParser()
    parsed_article = await parser.parse(url)
    
    if not parsed_article:
        return {"error": "–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å —Å—Ç–∞—Ç—å—é"}
    
    # 2. –¶–µ–Ω–∑—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ KB Curator Agent
    curator = KBCuratorAgent(llm_client, vector_db)
    processed_result = await curator.process_article(parsed_article)
    
    if not processed_result["accepted"]:
        return {
            "error": "–°—Ç–∞—Ç—å—è –Ω–µ –ø—Ä–æ—à–ª–∞ —Ü–µ–Ω–∑—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ",
            "reason": processed_result["rejection_reason"]
        }
    
    # 3. –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –≤ KB
    success = await curator.index_to_kb(processed_result)
    
    if not success:
        return {"error": "–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≤ KB"}
    
    return {
        "success": True,
        "article_id": processed_result["article"]["article_id"],
        "qa_count": len(processed_result["qa_pairs"])
    }
```

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —Ä–∞–±–æ—Ç—ã –∞–≥–µ–Ω—Ç–∞

### –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏:

1. **–ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∏–Ω—è—Ç—ã—Ö —Å—Ç–∞—Ç–µ–π**
   - –¶–µ–ª—å: > 70% —Å—Ç–∞—Ç–µ–π –ø—Ä–æ—Ö–æ–¥—è—Ç —Ü–µ–Ω–∑—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –ï—Å–ª–∏ –º–µ–Ω—å—à–µ ‚Üí —É–ª—É—á—à–∏—Ç—å –∫—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ç–±–æ—Ä–∞

2. **–ö–∞—á–µ—Å—Ç–≤–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö**
   - –ü—Ä–æ—Ü–µ–Ω—Ç —Å—Ç–∞—Ç–µ–π —Å –ø–æ–ª–Ω—ã–º–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
   - –¶–µ–ª—å: > 80%

3. **–ö–∞—á–µ—Å—Ç–≤–æ Q/A –ø–∞—Ä**
   - –°—Ä–µ–¥–Ω—è—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å (confidence)
   - –¶–µ–ª—å: > 0.8

4. **–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏**
   - –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å—Ç–∞—Ç—å–∏
   - –¶–µ–ª—å: < 30 —Å–µ–∫—É–Ω–¥

---

## üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ MVP

### –í —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–º –ø–ª–∞–Ω–µ (2 –Ω–µ–¥–µ–ª–∏):

**–î–µ–Ω—å 1-2: –†—É—á–Ω–æ–π –æ—Ç–±–æ—Ä —Å—Ç–∞—Ç–µ–π**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å KB Curator Agent –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –†—É—á–Ω–æ–π –æ—Ç–±–æ—Ä ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è ‚Üí –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –†—É—á–Ω–æ–π –æ—Ç–±–æ—Ä —Å—Ç–∞—Ç—å–∏ –∏–∑ 3dtoday.ru
2. –ü–∞—Ä—Å–∏–Ω–≥ (–ø—Ä–æ—Å—Ç–æ–π, –±–µ–∑ —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏)
3. **KB Curator Agent** –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ –≥–æ—Ç–æ–≤–∏—Ç –¥–ª—è KB
4. –ï—Å–ª–∏ –ø—Ä–∏–Ω—è—Ç–∞ ‚Üí –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è
5. –ï—Å–ª–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞ ‚Üí –∞–Ω–∞–ª–∏–∑ –ø—Ä–∏—á–∏–Ω, —É–ª—É—á—à–µ–Ω–∏–µ

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è** ‚Äî –Ω–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∫–∞–∂–¥—É—é —Å—Ç–∞—Ç—å—é
‚úÖ **–ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ** ‚Äî –≤—Å–µ —Å—Ç–∞—Ç—å–∏ –≤ –æ–¥–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
‚úÖ **–ì–æ—Ç–æ–≤—ã–µ Q/A –ø–∞—Ä—ã** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤
‚úÖ **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –º—É—Å–æ—Ä–∞** ‚Äî —Ç–æ–ª—å–∫–æ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ç–∞—Ç—å–∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ KB

---

## üìù –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```python
from backend.app.agents.kb_curator import KBCuratorAgent
from backend.app.services.llm_client import get_llm_client
from backend.app.services.vector_db import get_vector_db

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
llm_client = get_llm_client()
vector_db = get_vector_db()
curator = KBCuratorAgent(llm_client, vector_db)

# –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç—å–∏
parsed_article = {
    "url": "https://3dtoday.ru/...",
    "title": "–ö–∞–∫ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å stringing –Ω–∞ Ender-3",
    "content": "–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏...",
    "section": "–¢–µ—Ö–Ω–∏—á–∫–∞",
    "date": "2024-01-15"
}

result = await curator.process_article(parsed_article)

if result["accepted"]:
    print(f"‚úÖ –°—Ç–∞—Ç—å—è –ø—Ä–∏–Ω—è—Ç–∞: {result['article']['article_id']}")
    print(f"   Q/A –ø–∞—Ä: {len(result['qa_pairs'])}")
    print(f"   –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å: {result['validation']['relevance_score']:.2f}")
    
    # –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è
    await curator.index_to_kb(result)
else:
    print(f"‚ùå –°—Ç–∞—Ç—å—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞: {result['rejection_reason']}")
```

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ config.env:**

```env
# KB Curator Agent Configuration
KB_CURATOR_MIN_RELEVANCE=0.7
KB_CURATOR_MIN_QUALITY=0.6
KB_CURATOR_MIN_CONTENT_LENGTH=200
KB_CURATOR_QA_COUNT=3-5
KB_CURATOR_USE_LLM_VALIDATION=true
```

---

## üìö –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
backend/app/agents/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ kb_curator.py          # –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å KBCuratorAgent
‚îú‚îÄ‚îÄ content_validator.py   # ContentValidator
‚îú‚îÄ‚îÄ metadata_extractor.py # MetadataExtractor
‚îú‚îÄ‚îÄ qa_generator.py        # QAGenerator
‚îî‚îÄ‚îÄ kb_formatter.py        # KBFormatter
```

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –î–µ–Ω—å 1-2 (–≤ —Ä–∞–º–∫–∞—Ö MVP):
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å ContentValidator
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å MetadataExtractor
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å QAGenerator
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å KBFormatter
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ KBCuratorAgent
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ 2-3 —Å—Ç–∞—Ç—å—è—Ö

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–∞—Ä—Å–µ—Ä–æ–º
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –ë–î
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –∞–≥–µ–Ω—Ç–∞
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ —Ä–∞–±–æ—Ç—ã

---

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç** ‚Äî –æ—Ç–∫–ª–æ–Ω—è–µ—Ç –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Å—Ç–∞—Ç—å–∏
‚úÖ **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è** ‚Äî > 80% —Å—Ç–∞—Ç–µ–π —Å –ø–æ–ª–Ω—ã–º–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
‚úÖ **Q/A –ø–∞—Ä—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è** ‚Äî 3-5 –ø–∞—Ä –Ω–∞ —Å—Ç–∞—Ç—å—é
‚úÖ **–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏** ‚Äî < 30 —Å–µ–∫—É–Ω–¥ –Ω–∞ —Å—Ç–∞—Ç—å—é

---

## üí° –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (1-2 –º–µ—Å—è—Ü–∞):
- –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è LLM
- –ë–æ–ª–µ–µ —Ç–æ—á–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- –í–∞–ª–∏–¥–∞—Ü–∏—è Q/A –ø–∞—Ä –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ (3-6 –º–µ—Å—è—Ü–µ–≤):
- –û–±—É—á–µ–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑—å—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π



