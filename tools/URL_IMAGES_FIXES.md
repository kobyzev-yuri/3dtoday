# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ URL

**–î–∞—Ç–∞:** 2025-12-09  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ PDF, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ URL –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∏—Å—å –∏ –Ω–µ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–ª–∏—Å—å

---

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–Ω–µ—Å–µ–Ω—ã

### 1. –£–≤–µ–ª–∏—á–µ–Ω –ª–∏–º–∏—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (—Å—Ç—Ä–æ–∫–∞ 558)

**–ë–´–õ–û:**
```python
for img_url in images[:5]:  # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
```

**–°–¢–ê–õ–û:**
```python
for img_idx, img_data in enumerate(images[:20]):  # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–æ 20 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –¥–æ 20 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤–º–µ—Å—Ç–æ 5.

---

### 2. –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `analyze_image_from_url` –≤ VisionAnalyzer

**–î–û–ë–ê–í–õ–ï–ù–û:**
```python
def analyze_image_from_url(self, image_url: str, image_name: str = "image") -> Dict[str, Any]:
    """
    –ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ URL
    
    Args:
        image_url: URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        image_name: –ò–º—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    
    Returns:
        Dict —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –∞–Ω–∞–ª–∏–∑–∞
    """
    try:
        # –°–∫–∞—á–∏–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        response = httpx.get(image_url, timeout=30, headers={
            "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
        })
        response.raise_for_status()
        
        image_data = response.content
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä
        if len(image_data) > 20 * 1024 * 1024:  # 20MB –ª–∏–º–∏—Ç
            return {
                'success': False,
                'error': f'–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ: {len(image_data) / 1024 / 1024:.1f}MB'
            }
        
        return self.analyze_image(image_data, image_name)
        
    except httpx.HTTPError as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ HTTP –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è {image_url}: {e}")
        return {
            'success': False,
            'error': f'–û—à–∏–±–∫–∞ HTTP –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: {e}'
        }
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ URL {image_url}: {e}")
        return {
            'success': False,
            'error': f'–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: {e}'
        }
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–µ–ø–µ—Ä—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ URL —Å–∫–∞—á–∏–≤–∞—é—Ç—Å—è –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ Gemini Vision API.

---

### 3. –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ `add_from_parse`

**–ò–ó–ú–ï–ù–ï–ù–û:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ `check_relevance_to_3d_printing`
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–∫–∞—á–∏–≤–∞—é—Ç—Å—è –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
- –°–æ–∑–¥–∞—é—Ç—Å—è –∞–±—Å—Ç—Ä–∞–∫—Ç—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ Gemini
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∏–∑ –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ (problem_type, printer_models, materials)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ URL —Ç–µ–ø–µ—Ä—å:
- ‚úÖ –°–∫–∞—á–∏–≤–∞—é—Ç—Å—è
- ‚úÖ –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ Gemini Vision API
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –∫ 3D-–ø–µ—á–∞—Ç–∏
- ‚úÖ –ò–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è –≤ KB —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ –°–æ–∑–¥–∞—é—Ç—Å—è –∞–±—Å—Ç—Ä–∞–∫—Ç—ã –¥–ª—è –ø–æ–∏—Å–∫–∞

---

### 4. –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã

**–î–û–ë–ê–í–õ–ï–ù–û:**
```python
import base64
import httpx as httpx_client
import tempfile
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–æ–¥—É–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–æ –∏ –ø–æ—Å–ª–µ

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è |
|----------|----------------|-------------------|
| –õ–∏–º–∏—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π | ‚ùå 5 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π | ‚úÖ 20 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π |
| –ê–Ω–∞–ª–∏–∑ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π | ‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–ª | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ Gemini Vision API |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ | ‚ùå –ù–µ –ø—Ä–æ–≤–µ—Ä—è–ª–∞—Å—å | ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ |
| –°–æ–∑–¥–∞–Ω–∏–µ –∞–±—Å—Ç—Ä–∞–∫—Ç–æ–≤ | ‚ùå –ù–µ —Å–æ–∑–¥–∞–≤–∞–ª–∏—Å—å | ‚úÖ –°–æ–∑–¥–∞—é—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ |
| –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π | ‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–ª–∞ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ |

---

## üéØ –í—ã–≤–æ–¥—ã

1. ‚úÖ **–õ–∏–º–∏—Ç —É–≤–µ–ª–∏—á–µ–Ω:** –¢–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –¥–æ 20 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤–º–µ—Å—Ç–æ 5
2. ‚úÖ **–ê–Ω–∞–ª–∏–∑ URL —Ä–∞–±–æ—Ç–∞–µ—Ç:** –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ URL —Å–∫–∞—á–∏–≤–∞—é—Ç—Å—è –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è
3. ‚úÖ **–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Gemini
4. ‚úÖ **–ê–±—Å—Ç—Ä–∞–∫—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è:** –ù–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ URL!** üéâ

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–∫–∞—á–∏–≤–∞—é—Ç—Å—è –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `/tmp/kb_images/`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Gemini Vision API –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ (—á–µ—Ä–µ–∑ ProxyAPI)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∏–∑ –∞–Ω–∞–ª–∏–∑–∞ (problem_type, printer_models, materials)


