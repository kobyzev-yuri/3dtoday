# Архитектура интерфейсов проекта 3dtoday

## 🎯 Обзор

В проекте действительно **2 типа интерфейсов**:

1. **Административные интерфейсы** - для управления и тестирования KB
2. **Пользовательские интерфейсы** - для диагностики проблем 3D-печати

---

## 📊 Схема архитектуры

```
┌─────────────────────────────────────────────────────────────┐
│                    АДМИНИСТРАТИВНЫЕ ИНТЕРФЕЙСЫ              │
│              (для управления и тестирования KB)             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  1. Streamlit UI для сбора статей                          │
│     frontend/article_collector_ui.py                        │
│     - Добавление статей в KB                               │
│     - Валидация релевантности                              │
│     - Извлечение метаданных                                │
│     - Индексация в Qdrant                                  │
│                                                             │
│  2. CLI инструменты                                        │
│     backend/app/tools/article_collector.py                  │
│     - Интерактивный сбор статей                            │
│     - Тестирование индексации                              │
│                                                             │
│  3. Тестовые скрипты                                      │
│     backend/app/services/test_indexing.py                  │
│     - Тестирование поиска                                 │
│     - Проверка релевантности                              │
│                                                             │
└───────────────────────┬───────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────────┐
│                      FASTAPI BACKEND                        │
│                    (общий для всех)                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  - /diagnose - диагностика проблем                         │
│  - /kb/articles - управление статьями (админ)              │
│  - /kb/statistics - статистика KB (админ)                 │
│  - /health - проверка здоровья                             │
│                                                             │
└───────────────────────┬───────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────────┐
│                    БАЗА ЗНАНИЙ (KB)                        │
│                                                             │
│  - Qdrant (векторная БД)                                   │
│  - Статьи + метаданные                                     │
│  - Эмбеддинги (текст + изображения)                        │
│                                                             │
└───────────────────────┬───────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────────┐
│                  ПОЛЬЗОВАТЕЛЬСКИЕ ИНТЕРФЕЙСЫ               │
│              (для диагностики проблем)                      │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  1. Streamlit UI для диагностики (ШАГ 9)                  │
│     frontend/diagnostic_ui.py (планируется)                │
│     - Чат интерфейс                                        │
│     - Загрузка изображений дефектов                        │
│     - Получение рекомендаций                               │
│                                                             │
│  2. Telegram Bot (опционально, будущее)                    │
│     - Удобство для пользователей                           │
│     - Мобильный доступ                                     │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 🔧 Тип 1: Административные интерфейсы

### Назначение
Управление базой знаний: добавление, валидация, тестирование статей.

### Интерфейсы

#### 1. Streamlit UI для сбора статей
**Файл:** `frontend/article_collector_ui.py`

**Функции:**
- ✅ Форма ввода статьи (URL, заголовок, содержимое)
- ✅ Автоматическая валидация релевантности
- ✅ Визуализация результатов валидации
- ✅ Отображение извлеченных метаданных
- ✅ Индексация в Qdrant

**Запуск:**
```bash
streamlit run frontend/article_collector_ui.py
```

**Использование:**
- Администраторы KB
- Кураторы контента
- Тестировщики

#### 2. CLI инструмент для сбора статей
**Файл:** `backend/app/tools/article_collector.py`

**Функции:**
- ✅ Интерактивный ввод статей
- ✅ Валидация релевантности
- ✅ Извлечение метаданных
- ✅ Индексация

**Запуск:**
```bash
python3 backend/app/tools/article_collector.py
```

**Использование:**
- Автоматизация
- Скрипты миграции
- Тестирование

#### 3. Тестовые скрипты
**Файлы:**
- `backend/app/services/test_indexing.py` - тестирование индексации
- `backend/app/mcp/test_mcp_server.py` - тестирование MCP сервера

**Функции:**
- ✅ Тестирование поиска
- ✅ Проверка релевантности
- ✅ Валидация метаданных

---

## 👥 Тип 2: Пользовательские интерфейсы

### Назначение
Диагностика проблем 3D-печати для конечных пользователей.

### Интерфейсы

#### 1. Streamlit UI для диагностики (ШАГ 9)
**Файл:** `frontend/diagnostic_ui.py` (планируется)

**Функции:**
- ✅ Чат интерфейс для вопросов
- ✅ Загрузка изображений дефектов
- ✅ Получение рекомендаций
- ✅ Отображение решений с параметрами
- ✅ История диалога

**Запуск:**
```bash
streamlit run frontend/diagnostic_ui.py
```

**Использование:**
- Конечные пользователи
- Владельцы 3D-принтеров
- Люди с проблемами печати

#### 2. Telegram Bot (опционально, будущее)
**Функции:**
- ✅ Удобство для пользователей
- ✅ Мобильный доступ
- ✅ Быстрые ответы

---

## 🔄 Взаимодействие интерфейсов

### Поток данных для администраторов:

```
Администратор
    ↓
Streamlit UI (article_collector_ui.py)
    ↓
ArticleCollector (валидация + извлечение метаданных)
    ↓
ArticleIndexer (индексация)
    ↓
Qdrant (KB)
```

### Поток данных для пользователей:

```
Пользователь
    ↓
Streamlit UI (diagnostic_ui.py)
    ↓
FastAPI /diagnose endpoint
    ↓
Diagnostic Agent (MCP Client)
    ↓
KB MCP Server (поиск в KB)
    ↓
Qdrant (KB)
    ↓
Ответ пользователю
```

---

## 📋 Разделение ответственности

### Административные интерфейсы:
- ✅ **Сбор статей** - добавление новых статей в KB
- ✅ **Валидация** - проверка релевантности и качества
- ✅ **Извлечение метаданных** - автоматическое извлечение структурированных данных
- ✅ **Индексация** - добавление в векторную БД
- ✅ **Тестирование** - проверка работы поиска
- ✅ **Управление KB** - удаление, обновление статей

### Пользовательские интерфейсы:
- ✅ **Диагностика** - помощь в решении проблем
- ✅ **Анализ изображений** - распознавание дефектов
- ✅ **Рекомендации** - конкретные решения с параметрами
- ✅ **Диалог** - уточняющие вопросы

---

## 🎯 Итоговая схема

```
┌─────────────────────────────────────────────────────────┐
│              АДМИНИСТРАТИВНЫЕ ИНТЕРФЕЙСЫ                │
│  (для управления KB)                                    │
│                                                         │
│  • Streamlit: article_collector_ui.py                  │
│  • CLI: article_collector.py                           │
│  • Тесты: test_indexing.py                             │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│                  FASTAPI BACKEND                        │
│  (общий API для всех интерфейсов)                      │
│                                                         │
│  • /diagnose - диагностика                             │
│  • /kb/* - управление KB (админ)                       │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│                    БАЗА ЗНАНИЙ                          │
│  • Qdrant (векторная БД)                               │
│  • Статьи + метаданные                                  │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│            ПОЛЬЗОВАТЕЛЬСКИЕ ИНТЕРФЕЙСЫ                 │
│  (для диагностики)                                      │
│                                                         │
│  • Streamlit: diagnostic_ui.py (ШАГ 9)                 │
│  • Telegram Bot (опционально)                          │
└─────────────────────────────────────────────────────────┘
```

---

## ✅ Резюме

**Да, вы правильно поняли!**

У нас действительно **2 типа интерфейсов**:

1. **Административные** (для управления KB):
   - Сбор статей
   - Валидация релевантности
   - Тестирование
   - Управление KB

2. **Пользовательские** (для диагностики):
   - Чат для вопросов
   - Анализ изображений
   - Получение рекомендаций

**Общий компонент:**
- FastAPI Backend - единый API для обоих типов интерфейсов


