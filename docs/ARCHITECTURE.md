# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã 3dtoday

## üéØ –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º 3D-–ø–µ—á–∞—Ç–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –∞–≥–µ–Ω—Ç–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º RAG (Retrieval Augmented Generation) –∏ –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.

---

## üìä Dataflow –¥–∏–∞–≥—Ä–∞–º–º—ã

### –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö (–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞)

**–ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è:** VisionAgent –∏ DiagnosticAgent —Ä–∞–±–æ—Ç–∞—é—Ç –î–û RAG, —á—Ç–æ–±—ã –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∏ —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞.

```mermaid
flowchart TD
    Start([–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å]) --> Input{–¢–∏–ø –≤–≤–æ–¥–∞}
    
    Input -->|–¢–µ–∫—Å—Ç| TextInput[–¢–µ–∫—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å]
    Input -->|–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ| ImageInput[–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–µ—Ñ–µ–∫—Ç–∞]
    Input -->|–¢–µ–∫—Å—Ç + –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ| BothInput[–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤–≤–æ–¥]
    
    TextInput --> Orchestrator[Orchestrator Agent]
    ImageInput --> VisionAgent[Vision Agent<br/>üì∑ –ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è]
    BothInput --> VisionAgent
    
    VisionAgent -->|–û—Å–Ω–æ–≤–Ω–æ–π| GeminiAPI[Gemini Vision API<br/>—á–µ—Ä–µ–∑ ProxyAPI<br/>üì∑ –ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è]
    GeminiAPI -->|–£—Å–ø–µ—Ö| VisionResult[VisionResult:<br/>‚úÖ problem_type: stringing<br/>‚úÖ symptoms: –Ω–∏—Ç–æ—á–∫–∏, —Å–æ–ø–ª–∏<br/>‚úÖ description: —Ç–µ–∫—Å—Ç –æ–ø–∏—Å–∞–Ω–∏—è]
    GeminiAPI -->|–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω| VisionAnalysis[Fallback:<br/>llava Ollama<br/>LLM Vision API]
    VisionAnalysis --> VisionResult
    
    VisionResult --> Orchestrator
    BothInput --> Orchestrator
    
    Orchestrator --> SessionContext[SessionContext<br/>- –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞<br/>- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ<br/>- –°–æ—Å—Ç–æ—è–Ω–∏–µ<br/>- VisionResult]
    
    Orchestrator --> DiagnosticAgent[Diagnostic Agent<br/>üîç –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ RAG –∑–∞–ø—Ä–æ—Å–∞]
    
    DiagnosticAgent -->|1. –ò–∑–≤–ª–µ–∫–∞–µ—Ç problem_type<br/>–∏–∑ VisionResult| ExtractFilters[–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤:<br/>problem_type, printer_model, material]
    DiagnosticAgent -->|2. –û–±—ä–µ–¥–∏–Ω—è–µ—Ç —Ç–µ–∫—Å—Ç<br/>+ vision description| EnhancedQuery[–£–ª—É—á—à–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å:<br/>—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è +<br/>–æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è]
    
    ExtractFilters --> RAGQuery[–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ RAG –∑–∞–ø—Ä–æ—Å–∞:<br/>- –¢–µ–∫—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å<br/>- –§–∏–ª—å—Ç—Ä—ã –ø–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º]
    EnhancedQuery --> RAGQuery
    
    RAGQuery --> RetrievalAgent[Retrieval Agent<br/>üîé –ü–æ–∏—Å–∫ –≤ KB<br/>—Å —Ä–µ—Ä–∞–Ω–∫–∏–Ω–≥–æ–º]
    RetrievalAgent --> VectorDB[(Qdrant<br/>Vector DB)]
    
    VectorDB -->|–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫:<br/>–≤–µ–∫—Ç–æ—Ä–Ω—ã–π + —Ñ–∏–ª—å—Ç—Ä—ã| SearchResults[–†–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Å—Ç–∞—Ç—å–∏<br/>+ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ<br/>–æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω—ã –ø–æ problem_type]
    
    SearchResults --> LLM[LLM<br/>Ollama/ProxyAPI]
    SessionContext --> LLM
    
    LLM --> Answer[–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç<br/>+ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏]
    
    Answer --> UserResponse([–û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é])
    
    style Start fill:#e1f5ff
    style UserResponse fill:#e1f5ff
    style VectorDB fill:#fff4e1
    style LLM fill:#e8f5e9
    style SessionContext fill:#f3e5f5
    style VisionAgent fill:#fff9c4
    style DiagnosticAgent fill:#c8e6c9
    style RAGQuery fill:#e1bee7
```

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö RAG –ø–æ–∏—Å–∫–∞ —Å —Ä–µ—Ä–∞–Ω–∫–∏–Ω–≥–æ–º

**–ö–ª—é—á–µ–≤–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:** RAG –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫** - –∫–æ–º–±–∏–Ω–∞—Ü–∏—é —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ (—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫) –∏ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º), —Å –ø–æ—Å–ª–µ–¥—É—é—â–∏–º —Ä–µ—Ä–∞–Ω–∫–∏–Ω–≥–æ–º —á–µ—Ä–µ–∑ Cross-Encoder.

```mermaid
flowchart TD
    UserQuery([–ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:<br/>—Ç–µ–∫—Å—Ç + –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —Ñ–∏–ª—å—Ç—Ä—ã]) --> QueryProcessing[–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞]
    
    QueryProcessing --> ContextExtraction[–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞<br/>–∏–∑ SessionContext]
    
    ContextExtraction --> Filters[–§–∏–ª—å—Ç—Ä—ã-–∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞:<br/>- problem_type: stringing<br/>- printer_model: Ender-3<br/>- material: PLA]
    
    UserQuery --> EmbeddingGen[–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–∞<br/>–∑–∞–ø—Ä–æ—Å–∞<br/>SentenceTransformer]
    
    EmbeddingGen --> QueryEmbedding[–í–µ–∫—Ç–æ—Ä –∑–∞–ø—Ä–æ—Å–∞<br/>768-–º–µ—Ä–Ω—ã–π —ç–º–±–µ–¥–¥–∏–Ω–≥]
    
    QueryEmbedding --> QdrantSearch[Qdrant query_points<br/>query: –≤–µ–∫—Ç–æ—Ä –∑–∞–ø—Ä–æ—Å–∞<br/>query_filter: —Ñ–∏–ª—å—Ç—Ä—ã]
    Filters --> QdrantFilter[Qdrant Filter<br/>MatchValue/MatchAny<br/>–ø–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º]
    
    QdrantFilter --> QdrantSearch
    
    QdrantSearch --> HybridSearch[–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ –≤ Qdrant:<br/>1. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –î–û –ø–æ–∏—Å–∫–∞ (query_filter):<br/>   —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç—å–∏ —Å –Ω—É–∂–Ω—ã–º–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏<br/>2. –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º:<br/>   cosine similarity —Å—Ä–µ–¥–∏ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö]
    
    HybridSearch --> TopK[Top-K —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤<br/>k=10-20<br/>–æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ cosine similarity]
    
    TopK --> BoostFilters{boost_filters?}
    
    BoostFilters -->|–î–∞| BoostScore[–ë—É—Å—Ç–∏–Ω–≥ score:<br/>+0.1 –∑–∞ problem_type<br/>+0.1 –∑–∞ printer_model<br/>+0.1 –∑–∞ material]
    BoostFilters -->|–ù–µ—Ç| Reranking
    
    BoostScore --> Reranking[Re-ranking<br/>Cross-Encoder –º–æ–¥–µ–ª—å<br/>‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ]
    
    Reranking -->|–û—Ü–µ–Ω–∏–≤–∞–µ—Ç –ø–∞—Ä—ã<br/>query + article| RerankedResults[–ü–µ—Ä–µ—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã<br/>–±–æ–ª–µ–µ —Ç–æ—á–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏<br/>–Ω–∞—Ö–æ–¥–∏—Ç –ª—É—á—à–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã<br/>–¥–∞–∂–µ —Å —Ö—É–¥—à–∏–º cosine distance]
    
    RerankedResults --> RelevanceFilter[–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ<br/>relevance_score >= 0.3]
    
    RelevanceFilter --> Articles[–¢–æ–ø-K —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π<br/>k=5<br/>—Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏]
    
    Articles --> ContextFormation[–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞<br/>–¥–ª—è LLM]
    
    ContextFormation --> LLMPrompt[–ü—Ä–æ–º–ø—Ç –¥–ª—è LLM:<br/>- –ó–∞–ø—Ä–æ—Å<br/>- –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ —Å—Ç–∞—Ç–µ–π<br/>- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏]
    
    LLMPrompt --> LLM[LLM –≥–µ–Ω–µ—Ä–∞—Ü–∏—è<br/>Ollama/ProxyAPI]
    
    LLM --> Answer[–û—Ç–≤–µ—Ç —Å —Ä–µ—à–µ–Ω–∏—è–º–∏<br/>+ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏]
    
    Answer --> UserResponse([–û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é])
    
    style UserQuery fill:#e1f5ff
    style UserResponse fill:#e1f5ff
    style QdrantSearch fill:#fff4e1
    style LLM fill:#e8f5e9
    style QueryEmbedding fill:#c8e6c9
    style QdrantFilter fill:#ffccbc
    style HybridSearch fill:#e1bee7
    style Reranking fill:#fff9c4
    style RerankedResults fill:#c5e1a5
```

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–µ–π –≤ KB

```mermaid
flowchart TD
    Start([–ù–æ–≤–∞—è —Å—Ç–∞—Ç—å—è<br/>–∏–∑ –ø–∞—Ä—Å–µ—Ä–∞/–≤—Ä—É—á–Ω—É—é]) --> Parser[–ü–∞—Ä—Å–µ—Ä<br/>3dtoday.ru]
    
    Parser --> RawArticle[–°—ã—Ä–∞—è —Å—Ç–∞—Ç—å—è:<br/>- HTML –∫–æ–Ω—Ç–µ–Ω—Ç<br/>- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ]
    
    RawArticle --> CuratorAgent[KB Curator Agent]
    
    CuratorAgent --> ContentValidator[Content Validator<br/>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏]
    
    ContentValidator -->|relevance_score < 0.7| Reject1[‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ]
    ContentValidator -->|relevance_score >= 0.7| MetadataExtractor[Metadata Extractor<br/>–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö]
    
    MetadataExtractor -->|–ù–µ—Ç problem_type| Reject2[‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ]
    MetadataExtractor -->|–ï—Å—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ| QAGenerator[QA Generator<br/>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è Q/A –ø–∞—Ä]
    
    QAGenerator -->|3-5 Q/A –ø–∞—Ä| KBFormatter[KB Formatter<br/>–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ]
    
    KBFormatter --> ArticleData[–°—Ç–∞—Ç—å—è:<br/>- article_id<br/>- content<br/>- metadata]
    KBFormatter --> QAData[Q/A –ø–∞—Ä—ã:<br/>- question<br/>- answer<br/>- metadata]
    
    ArticleData --> EmbeddingService[Embedding Service<br/>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤]
    QAData --> EmbeddingService
    
    EmbeddingService --> VectorDB[(Qdrant<br/>–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è)]
    
    VectorDB --> Success[‚úÖ –°—Ç–∞—Ç—å—è –≤ KB]
    
    style Start fill:#e1f5ff
    style Success fill:#e8f5e9
    style Reject1 fill:#ffebee
    style Reject2 fill:#ffebee
    style VectorDB fill:#fff4e1
```

---

## ü§ñ –ê–≥–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 1. KB Librarian Agent (–ê–≥–µ–Ω—Ç-–∫—É—Ä–∞—Ç–æ—Ä KB)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –¶–µ–Ω–∑—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –∏–∑–≤–ª–µ—á–µ–Ω–Ω–æ–π –ø–∞—Ä—Å–µ—Ä–æ–º, –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å—Ç–∞—Ç–µ–π –¥–ª—è KB.

**–ó–∞–¥–∞—á–∏:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ –∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è summary –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `backend/app/agents/kb_librarian.py`

### 2. Diagnostic Agent (–ê–≥–µ–Ω—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ RAG –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ VisionAgent.

**–ö–ª—é—á–µ–≤–∞—è —Ä–æ–ª—å:** DiagnosticAgent —Ä–∞–±–æ—Ç–∞–µ—Ç **–î–û** RAG –ø–æ–∏—Å–∫–∞, —á—Ç–æ–±—ã:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ VisionAgent (`problem_type`, `symptoms`)
- –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è RAG –ø–æ–∏—Å–∫–∞
- –£–ª—É—á—à–∏—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å, –æ–±—ä–µ–¥–∏–Ω–∏–≤ —Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è + –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `backend/app/main.py` (endpoint `/api/diagnose`)

### 3. Vision Agent (–ê–≥–µ–Ω—Ç –∞–Ω–∞–ª–∏–∑–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–µ—Ñ–µ–∫—Ç–æ–≤ –ø–µ—á–∞—Ç–∏ –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

**–ö–ª—é—á–µ–≤–∞—è —Ä–æ–ª—å:** VisionAgent —Ä–∞–±–æ—Ç–∞–µ—Ç **–î–û** RAG –ø–æ–∏—Å–∫–∞, —á—Ç–æ–±—ã –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ RAG –∑–∞–ø—Ä–æ—Å–∞.

**–†–æ–ª—å Gemini:**
- üì∑ **Gemini Vision API** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–æ—Ç–æ –¥–µ—Ñ–µ–∫—Ç–∞)
- üîÑ Gemini –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (`problem_type`, `symptoms`, `description`)
- ‚úÖ –≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è DiagnosticAgent –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ RAG –∑–∞–ø—Ä–æ—Å–∞
- ‚ö†Ô∏è –ï—Å–ª–∏ Gemini –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback –Ω–∞ llava/Ollama

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `backend/app/services/vision_analyzer.py`

### 4. Retrieval Agent (–ê–≥–µ–Ω—Ç –ø–æ–∏—Å–∫–∞) ‚≠ê

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –ø–æ–∏—Å–∫ –≤ KB —Å —Ä–µ—Ä–∞–Ω–∫–∏–Ω–≥–æ–º –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

**–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (–≤–µ–∫—Ç–æ—Ä–Ω—ã–π + —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º)
- ‚úÖ **Re-ranking —á–µ—Ä–µ–∑ Cross-Encoder** –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö
- ‚úÖ –£–º–Ω–æ–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å —É—á–µ—Ç–æ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `backend/app/agents/retrieval_agent.py`

---

## üîß –°–µ—Ä–≤–∏—Å—ã

### 1. RAG Service

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ –≤ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –ë–î —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–µ—Ä–∞–Ω–∫–∏–Ω–≥–∞.

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫:**

1. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –î–û –ø–æ–∏—Å–∫–∞ (query_filter):**
   - –§–∏–ª—å—Ç—Ä—ã (`problem_type`, `printer_model`, `material`) ‚Üí —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `MatchValue`/`MatchAny`
   - Qdrant —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç **–î–û** –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ —á–µ—Ä–µ–∑ `query_filter`
   - –û—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç—å–∏ —Å –Ω—É–∂–Ω—ã–º–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –≤—Å–µ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏

2. **–í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º:**
   - –¢–µ–∫—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å ‚Üí `generate_embedding(query)` ‚Üí –≤–µ–∫—Ç–æ—Ä (768 —á–∏—Å–µ–ª)
   - –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –≤ Qdrant –ø–æ cosine similarity **—Å—Ä–µ–¥–∏ —É–∂–µ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π**

3. **Re-ranking —á–µ—Ä–µ–∑ Cross-Encoder:**
   - –ü–æ–ª—É—á–∞–µ–º —Ç–æ–ø-10-20 –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –ø–æ cosine similarity
   - Cross-Encoder –ø–µ—Ä–µ–æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –∫–∞–∂–¥—É—é –ø–∞—Ä—É (–∑–∞–ø—Ä–æ—Å + —Å—Ç–∞—Ç—å—è)
   - –ë–æ–ª–µ–µ —Ç–æ—á–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏, —É—á–∏—Ç—ã–≤–∞—é—â–∞—è —Å–µ–º–∞–Ω—Ç–∏–∫—É –∑–∞–ø—Ä–æ—Å–∞ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
   - –ù–∞—Ö–æ–¥–∏—Ç –ª—É—á—à–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã, –¥–∞–∂–µ –µ—Å–ª–∏ —É –Ω–∏—Ö —Ö—É–∂–µ cosine distance

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `backend/app/services/rag_service.py`

### 2. Vector DB Service

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –†–∞–±–æ—Ç–∞ —Å Qdrant (–≤–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î).

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Å—Ç–∞—Ç–µ–π —Å —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º–∏
- –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º–∏
- –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `backend/app/services/vector_db.py`

### 3. LLM Client

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å LLM.

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã:**
- Ollama (–ª–æ–∫–∞–ª—å–Ω–æ)
- OpenAI —á–µ—Ä–µ–∑ ProxyAPI
- Gemini —á–µ—Ä–µ–∑ ProxyAPI

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `backend/app/services/llm_client.py`

### 4. Article Indexer

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Å—Ç–∞—Ç–µ–π –≤ –≤–µ–∫—Ç–æ—Ä–Ω—É—é –ë–î.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `backend/app/services/article_indexer.py`

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –°—Ç–∞—Ç—å—è –≤ KB

```json
{
  "article_id": "stringing_pla_ender3",
  "title": "–ö–∞–∫ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å stringing –ø—Ä–∏ –ø–µ—á–∞—Ç–∏ PLA",
  "content": "–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏...",
  "url": "https://3dtoday.ru/...",
  "problem_type": "stringing",
  "printer_models": ["Ender-3", "Ender-3 V2"],
  "materials": ["PLA"],
  "symptoms": ["–Ω–∏—Ç–æ—á–∫–∏ –º–µ–∂–¥—É –¥–µ—Ç–∞–ª—è–º–∏", "—Å–æ–ø–ª–∏"],
  "solutions": [
    {
      "parameter": "retraction_length",
      "value": 6,
      "unit": "mm",
      "description": "–£–≤–µ–ª–∏—á—å—Ç–µ retraction –¥–æ 6 –º–º"
    }
  ]
}
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ —Ä–∞–±–æ—Ç–µ –∞–≥–µ–Ω—Ç–æ–≤: —Å–º. –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –≤ `backend/app/agents/`
- –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ —Å–µ—Ä–≤–∏—Å–∞—Ö: —Å–º. –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –≤ `backend/app/services/`
- –°—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏: —Å–º. `archive/ARCHITECTURE.md` –∏ `archive/DATAFLOW_DIAGRAM.md`
