# –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞

## üìù –û–ø–∏—Å–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø–æ–∏—Å–∫–∞ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏. –ü—Ä–∏ –∫–∞–∂–¥–æ–º –Ω–æ–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. Endpoint `/api/diagnose/image`

**–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞:**
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `conversation_history` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –¥–∏–∞–ª–æ–≥–∞ –∫ —Ç–µ–∫—É—â–µ–º—É –∑–∞–ø—Ä–æ—Å—É

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```python
{
    "query": "–ê —á—Ç–æ –µ—Å–ª–∏ —É–≤–µ–ª–∏—á–∏—Ç—å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É?",
    "conversation_history": [
        {"role": "user", "content": "–ù–∏—Ç–æ—á–∫–∏ –ø—Ä–∏ –ø–µ—á–∞—Ç–∏"},
        {"role": "assistant", "content": "–≠—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ stringing..."}
    ],
    "image": <file>
}
```

### 2. Frontend (`user_ui.py`)

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –∏—Å—Ç–æ—Ä–∏–∏:**
- –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ API –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ `st.session_state.conversation_history`
- –ò—Å—Ç–æ—Ä–∏—è —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —Ç–æ–ª—å–∫–æ `role` –∏ `content`

## üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –£–ª—É—á—à–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ —Å —É—á–µ—Ç–æ–º –∏—Å—Ç–æ—Ä–∏–∏

1. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:**
   - –ë–µ—Ä–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
   - –§–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è —Ç–µ–∫—Å—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∏ –æ—Ç–≤–µ—Ç–∞–º–∏

2. **–£–ª—É—á—à–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞:**
   ```
   –ò—Å—Ö–æ–¥–Ω—ã–π –∑–∞–ø—Ä–æ—Å: "–ê —á—Ç–æ –µ—Å–ª–∏ —É–≤–µ–ª–∏—á–∏—Ç—å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É?"
   
   –£–ª—É—á—à–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å:
   "–ê —á—Ç–æ –µ—Å–ª–∏ —É–≤–µ–ª–∏—á–∏—Ç—å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É?
   
   –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –¥–∏–∞–ª–æ–≥–∞:
   –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ù–∏—Ç–æ—á–∫–∏ –ø—Ä–∏ –ø–µ—á–∞—Ç–∏
   –°–∏—Å—Ç–µ–º–∞: –≠—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ stringing..."
   ```

3. **–ü–æ–∏—Å–∫:**
   - –£–ª—É—á—à–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ KB
   - –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–º–æ–≥–∞–µ—Ç –Ω–∞–π—Ç–∏ –±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Å—Ç–∞—Ç—å–∏

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ —É—Ç–æ—á–Ω–µ–Ω–∏—è

**–ó–∞–ø—Ä–æ—Å 1:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ù–∏—Ç–æ—á–∫–∏ –ø—Ä–∏ –ø–µ—á–∞—Ç–∏"
–°–∏—Å—Ç–µ–º–∞: –ù–∞—Ö–æ–¥–∏—Ç —Å—Ç–∞—Ç—å–∏ –ø—Ä–æ stringing
```

**–ó–∞–ø—Ä–æ—Å 2 (—Å –∏—Å—Ç–æ—Ä–∏–µ–π):**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ê —á—Ç–æ –µ—Å–ª–∏ —É–≤–µ–ª–∏—á–∏—Ç—å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É?"
–°–∏—Å—Ç–µ–º–∞: –ü–æ–Ω–∏–º–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç (stringing) –∏ –∏—â–µ—Ç —Å—Ç–∞—Ç—å–∏ –ø—Ä–æ –≤–ª–∏—è–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –Ω–∞ stringing
```

### –ü—Ä–∏–º–µ—Ä 2: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**–ó–∞–ø—Ä–æ—Å 1:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–µ—á–∞—Ç—å—é" + –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
–°–∏—Å—Ç–µ–º–∞: –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –Ω–∞—Ö–æ–¥–∏—Ç —Å—Ç–∞—Ç—å–∏ –ø—Ä–æ stringing
```

**–ó–∞–ø—Ä–æ—Å 2 (—Å –∏—Å—Ç–æ—Ä–∏–µ–π):**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ò—Å–ø–æ–ª—å–∑—É—é PLA –Ω–∞ Ender-3"
–°–∏—Å—Ç–µ–º–∞: –£—á–∏—Ç—ã–≤–∞–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (stringing) –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä—ã (PLA, Ender-3)
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- **–ú–∞–∫—Å–∏–º—É–º —Å–æ–æ–±—â–µ–Ω–∏–π:** –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
- **–î–ª–∏–Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞:** –û—Ç–≤–µ—Ç—ã —Å–∏—Å—Ç–µ–º—ã –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—é—Ç—Å—è –¥–æ 200 —Å–∏–º–≤–æ–ª–æ–≤ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
- **–¢–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π:** –£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Å `role` –∏ `content`

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í –ª–æ–≥–∞—Ö –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å:
```
üìù –ó–∞–ø—Ä–æ—Å —É–ª—É—á—à–µ–Ω —Å —É—á–µ—Ç–æ–º –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞ (2 —Å–æ–æ–±—â–µ–Ω–∏–π)
üîç –ü–æ–∏—Å–∫ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º: query='...', history_len=2
```

## üîç –û—Ç–ª–∞–¥–∫–∞

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   ```bash
   tail -f logs/user_ui.log | grep "–∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞"
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–ø—Ä–æ—Å:**
   - –í –ª–æ–≥–∞—Ö API –±—É–¥–µ—Ç –≤–∏–¥–Ω–æ —É–ª—É—á—à–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `conversation_history` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –∑–∞–ø—Ä–æ—Å–µ

3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –°–¥–µ–ª–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å
   - –°–¥–µ–ª–∞–π—Ç–µ –≤—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å —Å —É—Ç–æ—á–Ω–µ–Ω–∏–µ–º
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å —É—á–∏—Ç—ã–≤–∞–µ—Ç –ø–µ—Ä–≤—ã–π

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ö—Ä–∞—Ç–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã:** –ò—Å—Ç–æ—Ä–∏—è –ø–æ–º–æ–≥–∞–µ—Ç —Å–∏—Å—Ç–µ–º–µ –ø–æ–Ω—è—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –∫–æ—Ä–æ—Ç–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
2. **–£—Ç–æ—á–Ω–µ–Ω–∏—è:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏—Å—Ç–æ—Ä–∏—é –¥–ª—è —É—Ç–æ—á–Ω—è—é—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
3. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:** –î–æ–±–∞–≤–ª—è–π—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ, —Å–∏—Å—Ç–µ–º–∞ –∑–∞–ø–æ–º–Ω–∏—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç

## üöÄ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ LLM –¥–ª—è –±–æ–ª–µ–µ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ —Å —É—á–µ—Ç–æ–º –∏—Å—Ç–æ—Ä–∏–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±–æ–ª–µ–µ –¥–ª–∏–Ω–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞

