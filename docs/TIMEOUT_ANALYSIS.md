# –ê–Ω–∞–ª–∏–∑ —Ç–∞–π–º–∞—É—Ç–æ–≤ –∏ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ —Å—Ç–∞—Ç–µ–π

## üîç –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ç–∞–π–º–∞—É—Ç–∞–º–∏

### 1. –¢–∞–π–º–∞—É—Ç—ã HTTP –∑–∞–ø—Ä–æ—Å–æ–≤

**–ì–¥–µ:** `backend/app/services/document_parser.py`, `article_parser.py`, `questions_parser.py`

**–¢–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è:**
- `DOCUMENT_PARSER_TIMEOUT=30` —Å–µ–∫ (config.env)
- `ARTICLE_PARSER_TIMEOUT=30` —Å–µ–∫
- `QUESTIONS_PARSER_TIMEOUT=30` —Å–µ–∫

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ö†Ô∏è –î–ª—è –±–æ–ª—å—à–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü 30 —Å–µ–∫ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
- ‚ö†Ô∏è –ú–µ–¥–ª–µ–Ω–Ω—ã–µ —Å–∞–π—Ç—ã –º–æ–≥—É—Ç –Ω–µ —É—Å–ø–µ—Ç—å –æ—Ç–≤–µ—Ç–∏—Ç—å
- ‚ö†Ô∏è –ù–µ—Ç retry –ª–æ–≥–∏–∫–∏ –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ—è—Ö

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
```python
# –£–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞
DOCUMENT_PARSER_TIMEOUT=60  # –£–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 60 —Å–µ–∫
```

---

### 2. –¢–∞–π–º–∞—É—Ç—ã LLM –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

**–ì–¥–µ:** `backend/app/services/llm_client.py`

**–¢–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è:**
- `OLLAMA_TIMEOUT=500` —Å–µ–∫ (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π)
- `OPENAI_TIMEOUT=60` —Å–µ–∫ (–¥–ª—è –æ–±–ª–∞—á–Ω—ã—Ö API)
- `MCP_SERVER_TIMEOUT=180` —Å–µ–∫ (–¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ + –∞–Ω–∞–ª–∏–∑–∞)

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ö†Ô∏è Ollama –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–º –Ω–∞ —Å–ª–∞–±–æ–º –∂–µ–ª–µ–∑–µ
- ‚ö†Ô∏è –ë–æ–ª—å—à–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã —Ç—Ä–µ–±—É—é—Ç –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –∞–Ω–∞–ª–∏–∑
- ‚ö†Ô∏è –ù–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å-–∏–Ω–¥–∏–∫–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –£–≤–µ–ª–∏—á–∏—Ç—å `MCP_SERVER_TIMEOUT` –¥–æ 300-600 —Å–µ–∫ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å-–∏–Ω–¥–∏–∫–∞—Ü–∏—é –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

---

### 3. –¢–∞–π–º–∞—É—Ç—ã MCP —Å–µ—Ä–≤–µ—Ä–∞

**–ì–¥–µ:** `backend/app/mcp/kb_mcp_server.py`

**–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:**
- `MCP_SERVER_TIMEOUT=180` —Å–µ–∫

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ö†Ô∏è –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª (–ø–∞—Ä—Å–∏–Ω–≥ + –∞–Ω–∞–ª–∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä–µ–º) –º–æ–∂–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
- ‚ö†Ô∏è –î–ª—è –±–æ–ª—å—à–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –º–æ–∂–µ—Ç –Ω–µ —Ö–≤–∞—Ç–∏—Ç—å –≤—Ä–µ–º–µ–Ω–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
```python
# –£–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç –¥–ª—è MCP
MCP_SERVER_TIMEOUT=300  # 5 –º–∏–Ω—É—Ç –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
```

---

### 4. –¢–∞–π–º–∞—É—Ç—ã API –∑–∞–ø—Ä–æ—Å–æ–≤

**–ì–¥–µ:** `frontend/admin_ui.py`

**–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:**
- `API_REQUEST_TIMEOUT=120` —Å–µ–∫

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ö†Ô∏è –ï—Å–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥ + –∞–Ω–∞–ª–∏–∑ –∑–∞–Ω–∏–º–∞–µ—Ç –±–æ–ª—å—à–µ 120 —Å–µ–∫, –∑–∞–ø—Ä–æ—Å –ø—Ä–µ—Ä–≤–µ—Ç—Å—è
- ‚ö†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —É–≤–∏–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –£–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 300-600 —Å–µ–∫ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

---

## üêõ –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏

### 1. Connection timeout

**–°–∏–º–ø—Ç–æ–º—ã:**
```
httpx.ConnectTimeout: [Errno 111] Connection refused
```

**–ü—Ä–∏—á–∏–Ω—ã:**
- –°–∞–π—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ IP
- –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏—Ç—å retry –ª–æ–≥–∏–∫—É
- –£–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–∫—Å–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

### 2. Read timeout

**–°–∏–º–ø—Ç–æ–º—ã:**
```
httpx.ReadTimeout: The read operation timed out
```

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ú–µ–¥–ª–µ–Ω–Ω—ã–π —Å–∞–π—Ç
- –ë–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é

**–†–µ—à–µ–Ω–∏–µ:**
- –£–≤–µ–ª–∏—á–∏—Ç—å `DOCUMENT_PARSER_TIMEOUT`
- –î–æ–±–∞–≤–∏—Ç—å streaming –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤

### 3. LLM timeout

**–°–∏–º–ø—Ç–æ–º—ã:**
```
asyncio.TimeoutError: Operation timed out
```

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ú–µ–¥–ª–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å Ollama
- –ë–æ–ª—å—à–æ–π –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
- –ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞ —Å–∏—Å—Ç–µ–º—ã

**–†–µ—à–µ–Ω–∏–µ:**
- –£–≤–µ–ª–∏—á–∏—Ç—å `OLLAMA_TIMEOUT` –∏–ª–∏ `MCP_SERVER_TIMEOUT`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä—É—é –º–æ–¥–µ–ª—å
- –†–∞–∑–±–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç –Ω–∞ —á–∞—Å—Ç–∏

### 4. Qdrant timeout

**–°–∏–º–ø—Ç–æ–º—ã:**
```
qdrant_client.exceptions.TimeoutException
```

**–ü—Ä–∏—á–∏–Ω—ã:**
- Qdrant –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω
- –ë–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä –≤–µ–∫—Ç–æ—Ä–æ–≤
- –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Qdrant
- –£–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç Qdrant –∫–ª–∏–µ–Ω—Ç–∞

---

## üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

### 1. –£–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç—ã –≤ config.env

```env
# –£–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç—ã –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞
DOCUMENT_PARSER_TIMEOUT=60
ARTICLE_PARSER_TIMEOUT=60
QUESTIONS_PARSER_TIMEOUT=60

# –£–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
MCP_SERVER_TIMEOUT=300

# –£–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç API –∑–∞–ø—Ä–æ—Å–æ–≤
API_REQUEST_TIMEOUT=300
```

### 2. –î–æ–±–∞–≤–∏—Ç—å retry –ª–æ–≥–∏–∫—É

```python
# –í document_parser.py
async def parse_document(self, source: str, max_retries: int = 3):
    for attempt in range(max_retries):
        try:
            return await self._parse_html(source)
        except httpx.TimeoutException:
            if attempt < max_retries - 1:
                await asyncio.sleep(2 ** attempt)  # Exponential backoff
                continue
            raise
```

### 3. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å-–∏–Ω–¥–∏–∫–∞—Ü–∏—é

```python
# –í admin_ui.py
with st.spinner("üì• –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏ –∞–Ω–∞–ª–∏–∑ —Å—Ç–∞—Ç—å–∏..."):
    # –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
    progress_bar = st.progress(0)
    # –û–±–Ω–æ–≤–ª—è—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —ç—Ç–∞–ø–æ–≤
```

### 4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–æ–≤

```python
# –î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
logger.warning(f"‚ö†Ô∏è –¢–∞–π–º–∞—É—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞: {url} (timeout={timeout} —Å–µ–∫)")
logger.info(f"‚è±Ô∏è –í—Ä–µ–º—è –ø–∞—Ä—Å–∏–Ω–≥–∞: {elapsed_time:.2f} —Å–µ–∫")
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç–∞–π–º–∞—É—Ç–æ–≤

### –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∞–π–º–∞—É—Ç–æ–≤

```python
# scripts/check_timeouts.py
import asyncio
import time
from backend.app.services.document_parser import DocumentParser

async def check_timeout(url: str):
    parser = DocumentParser()
    start = time.time()
    
    try:
        result = await asyncio.wait_for(
            parser.parse_document(url, 'html'),
            timeout=parser.timeout + 10
        )
        elapsed = time.time() - start
        print(f"‚úÖ –£—Å–ø–µ—à–Ω–æ –∑–∞ {elapsed:.2f} —Å–µ–∫")
        return True
    except asyncio.TimeoutError:
        elapsed = time.time() - start
        print(f"‚ùå –¢–∞–π–º–∞—É—Ç –ø–æ—Å–ª–µ {elapsed:.2f} —Å–µ–∫")
        return False
```

---

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
   - –£–≤–µ–ª–∏—á–∏—Ç—å `MCP_SERVER_TIMEOUT` –¥–æ 300 —Å–µ–∫
   - –£–≤–µ–ª–∏—á–∏—Ç—å `API_REQUEST_TIMEOUT` –¥–æ 300 —Å–µ–∫
   - –î–æ–±–∞–≤–∏—Ç—å retry –ª–æ–≥–∏–∫—É –¥–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤

2. **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
   - –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å-–∏–Ω–¥–∏–∫–∞—Ü–∏—é –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
   - –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–æ–≤
   - –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

3. **–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è
   - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–∞—Ä—Å–∏–Ω–≥–∞
   - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- `config.env` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–∞–π–º–∞—É—Ç–æ–≤
- `docs/TIMEOUT_CONFIGURATION.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ç–∞–π–º–∞—É—Ç–∞–º
- `backend/app/services/document_parser.py` - –ø–∞—Ä—Å–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- `backend/app/agents/kb_librarian.py` - –∞–≥–µ–Ω—Ç-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä—å


