# FastAPI API Reference

–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –≤—Å–µ–º API endpoints –ø—Ä–æ–µ–∫—Ç–∞ 3dtoday.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–ë–∞–∑–æ–≤—ã–µ endpoints](#–±–∞–∑–æ–≤—ã–µ-endpoints)
- [–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º](#–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞-–ø—Ä–æ–±–ª–µ–º)
- [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π (KB)](#—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–±–∞–∑–æ–π-–∑–Ω–∞–Ω–∏–π-kb)
- [–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ](#—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞-–∏-–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ)

## üîó –ë–∞–∑–æ–≤—ã–µ endpoints

### `GET /`
–ö–æ—Ä–Ω–µ–≤–æ–π endpoint, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± API.

**–û—Ç–≤–µ—Ç:**
```json
{
  "message": "3dtoday Diagnostic API",
  "version": "0.1.0",
  "endpoints": {
    "diagnose": "/api/diagnose",
    "kb_validate": "/api/kb/articles/validate",
    "kb_add": "/api/kb/articles/add",
    "kb_statistics": "/api/kb/statistics",
    "health": "/health"
  }
}
```

### `GET /health`
–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–∞.

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "healthy",
  "version": "0.1.0"
}
```

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### `POST /api/diagnose`
–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã 3D-–ø–µ—á–∞—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (JSON):**
```json
{
  "query": "–£ –º–µ–Ω—è –ø–æ—è–≤–ª—è—é—Ç—Å—è –Ω–∏—Ç–æ—á–∫–∏ –º–µ–∂–¥—É –¥–µ—Ç–∞–ª—è–º–∏ –ø—Ä–∏ –ø–µ—á–∞—Ç–∏ PLA –Ω–∞ Ender-3",
  "printer_model": "Ender-3",
  "material": "PLA",
  "problem_type": "stringing",
  "llm_provider": "gemini",
  "llm_model": "gemini-3-pro-preview",
  "llm_timeout": 600
}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `query` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π, string): –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
- `printer_model` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, string): –ú–æ–¥–µ–ª—å –ø—Ä–∏–Ω—Ç–µ—Ä–∞
- `material` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, string): –ú–∞—Ç–µ—Ä–∏–∞–ª (PLA, PETG, ABS –∏ —Ç.–¥.)
- `problem_type` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, string): –¢–∏–ø –ø—Ä–æ–±–ª–µ–º—ã (stringing, warping, layer_separation –∏ —Ç.–¥.)
- `llm_provider` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, string): –ü—Ä–æ–≤–∞–π–¥–µ—Ä LLM (`ollama`, `openai`, `gemini`)
- `llm_model` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, string): –ú–æ–¥–µ–ª—å LLM
- `llm_timeout` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, int): –¢–∞–π–º–∞—É—Ç –¥–ª—è LLM –≤ —Å–µ–∫—É–Ω–¥–∞—Ö

**–û—Ç–≤–µ—Ç:**
```json
{
  "answer": "–ü–æ—Ö–æ–∂–µ, —É —Ç–µ–±—è –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ stringing (—Å–æ–ø–ª–∏)...",
  "needs_clarification": false,
  "clarification_questions": null,
  "relevant_articles": [
    {
      "title": "–ö–∞–∫ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å stringing (—Å–æ–ø–ª–∏) –ø—Ä–∏ –ø–µ—á–∞—Ç–∏ PLA",
      "url": "https://3dtoday.ru/...",
      "score": 0.95
    }
  ],
  "confidence": 0.8
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç RAG –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–π –æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ LLM –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π
- –ú–æ–∂–µ—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç—å —É—Ç–æ—á–Ω–µ–Ω–∏—è, –µ—Å–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ

---

### `POST /api/diagnose/image`
–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å –∞–Ω–∞–ª–∏–∑–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–µ—Ñ–µ–∫—Ç–∞.

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (multipart/form-data):**
- `query` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π, string): –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
- `image` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π, file): –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–µ—Ñ–µ–∫—Ç–∞ (PNG, JPG, JPEG)
- `printer_model` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, string): –ú–æ–¥–µ–ª—å –ø—Ä–∏–Ω—Ç–µ—Ä–∞
- `material` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, string): –ú–∞—Ç–µ—Ä–∏–∞–ª
- `problem_type` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, string): –¢–∏–ø –ø—Ä–æ–±–ª–µ–º—ã
- `conversation_history` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, string): –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON —Å—Ç—Ä–æ–∫–∏
- `use_reranking` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, string): –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ—Ä–∞–Ω–∫–∏–Ω–≥ (`"true"` –∏–ª–∏ `"false"`, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `"true"`)
- `limit` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, string): –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `"5"`)

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ (curl):**
```bash
curl -X POST "http://localhost:8000/api/diagnose/image" \
  -F "query=–£ –º–µ–Ω—è –ø–æ—è–≤–ª—è—é—Ç—Å—è –Ω–∏—Ç–æ—á–∫–∏ –º–µ–∂–¥—É –¥–µ—Ç–∞–ª—è–º–∏" \
  -F "image=@/path/to/image.jpg" \
  -F "printer_model=Ender-3" \
  -F "material=PLA" \
  -F "conversation_history=[]" \
  -F "use_reranking=true" \
  -F "limit=5"
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "answer": "–ù–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤–∏–∂—É, —á—Ç–æ —É —Ç–µ–±—è –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ stringing...",
  "query": "–£ –º–µ–Ω—è –ø–æ—è–≤–ª—è—é—Ç—Å—è –Ω–∏—Ç–æ—á–∫–∏ –º–µ–∂–¥—É –¥–µ—Ç–∞–ª—è–º–∏",
  "image_name": "image.jpg",
  "image_size": 10240,
  "relevant_articles": [
    {
      "article_id": "stringing_pla_001",
      "title": "–ö–∞–∫ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å stringing (—Å–æ–ø–ª–∏) –ø—Ä–∏ –ø–µ—á–∞—Ç–∏ PLA",
      "content": "Stringing (—Å–æ–ø–ª–∏) - —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞...",
      "url": "https://3dtoday.ru/...",
      "score": 0.98,
      "rerank_score": 0.993,
      "problem_type": "stringing",
      "printer_models": ["Ender-3", "Prusa i3"],
      "materials": ["PLA"]
    }
  ],
  "results_count": 5,
  "confidence": 0.9,
  "needs_clarification": false,
  "clarification_questions": null,
  "image_analysis": true
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Gemini Vision API –∏–ª–∏ Ollama/llava (fallback)
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (problem_type, symptoms, description)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç RetrievalAgent –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å —É—á–µ—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ä–µ—Ä–∞–Ω–∫–∏–Ω–≥ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–π –æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ LLM –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤

---

## üìö –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π (KB)

### `POST /api/kb/articles/add`
–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—å–∏ –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π.

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (JSON):**
```json
{
  "article_id": "stringing_pla_001",
  "title": "–ö–∞–∫ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å stringing (—Å–æ–ø–ª–∏) –ø—Ä–∏ –ø–µ—á–∞—Ç–∏ PLA",
  "content": "–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏...",
  "url": "https://3dtoday.ru/articles/stringing-pla",
  "problem_type": "stringing",
  "printer_models": ["Ender-3", "Prusa i3"],
  "materials": ["PLA"],
  "symptoms": ["–Ω–∏—Ç–æ—á–∫–∏", "—Å–æ–ø–ª–∏", "–ø–∞—É—Ç–∏–Ω–∞"],
  "solutions": [
    {
      "description": "–£–º–µ–Ω—å—à–∏—Ç—å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É —Å–æ–ø–ª–∞",
      "parameters": {"temperature": 200}
    }
  ],
  "section": "–¢–µ—Ö–Ω–∏—á–∫–∞",
  "date": "2024-01-01"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "article_id": "stringing_pla_001",
  "message": "–°—Ç–∞—Ç—å—è —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π"
}
```

---

### `POST /api/kb/articles/parse`
–ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç–∞—Ç—å–∏ —Å URL –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è LLM.

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (JSON):**
```json
{
  "url": "https://3dtoday.ru/articles/stringing-pla"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "article": {
    "title": "–ö–∞–∫ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å stringing...",
    "content": "...",
    "url": "https://3dtoday.ru/articles/stringing-pla"
  }
}
```

---

### `POST /api/kb/articles/parse_with_llm`
–ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç–∞—Ç—å–∏ —Å URL —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º LLM –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (JSON):**
```json
{
  "url": "https://3dtoday.ru/articles/stringing-pla",
  "llm_provider": "gemini",
  "llm_model": "gemini-3-pro-preview"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "article": {
    "title": "–ö–∞–∫ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å stringing...",
    "content": "...",
    "problem_type": "stringing",
    "printer_models": ["Ender-3"],
    "materials": ["PLA"],
    "solutions": [...]
  }
}
```

---

### `POST /api/kb/articles/add_from_parse`
–ü–∞—Ä—Å–∏–Ω–≥ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—å–∏ –≤ –æ–¥–Ω—É –æ–ø–µ—Ä–∞—Ü–∏—é.

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (JSON):**
```json
{
  "url": "https://3dtoday.ru/articles/stringing-pla",
  "use_llm": true,
  "llm_provider": "gemini"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "article_id": "generated_id",
  "message": "–°—Ç–∞—Ç—å—è —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞"
}
```

---

### `POST /api/kb/articles/validate`
–í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç–∞—Ç—å–∏ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º.

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (JSON):**
```json
{
  "article_id": "stringing_pla_001",
  "title": "–ö–∞–∫ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å stringing...",
  "content": "...",
  "url": "https://3dtoday.ru/articles/stringing-pla"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "valid": true,
  "errors": [],
  "warnings": []
}
```

---

### `GET /api/kb/articles`
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å—Ç–∞—Ç–µ–π.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**
- `limit` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, int): –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–∞—Ç–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10)
- `offset` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, int): –°–º–µ—â–µ–Ω–∏–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0)

**–ü—Ä–∏–º–µ—Ä:**
```bash
curl "http://localhost:8000/api/kb/articles?limit=5&offset=0"
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "articles": [
    {
      "article_id": "stringing_pla_001",
      "title": "–ö–∞–∫ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å stringing...",
      "url": "https://3dtoday.ru/...",
      "section": "–¢–µ—Ö–Ω–∏—á–∫–∞",
      "problem_type": "stringing",
      "content_preview": "–ü–µ—Ä–≤—ã–µ 200 —Å–∏–º–≤–æ–ª–æ–≤..."
    }
  ],
  "total": 10,
  "limit": 5,
  "offset": 0
}
```

---

### `GET /api/kb/articles/{article_id}`
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—å–∏ –ø–æ ID.

**–ü—Ä–∏–º–µ—Ä:**
```bash
curl "http://localhost:8000/api/kb/articles/stringing_pla_001"
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "article_id": "stringing_pla_001",
  "title": "–ö–∞–∫ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å stringing (—Å–æ–ø–ª–∏) –ø—Ä–∏ –ø–µ—á–∞—Ç–∏ PLA",
  "content": "–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏...",
  "url": "https://3dtoday.ru/...",
  "problem_type": "stringing",
  "printer_models": ["Ender-3"],
  "materials": ["PLA"],
  "symptoms": ["–Ω–∏—Ç–æ—á–∫–∏", "—Å–æ–ø–ª–∏"],
  "solutions": [...],
  "section": "–¢–µ—Ö–Ω–∏—á–∫–∞",
  "date": "2024-01-01"
}
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ

### `GET /api/kb/statistics`
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π.

**–û—Ç–≤–µ—Ç:**
```json
{
  "text_articles": 150,
  "images": 25,
  "total_vectors": 175
}
```

---

### `GET /api/kb/metadata/unique-values`
–ü–æ–ª—É—á–µ–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**
- `field` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π, string): –ü–æ–ª–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (`problem_type`, `printer_models`, `materials`)

**–ü—Ä–∏–º–µ—Ä:**
```bash
curl "http://localhost:8000/api/kb/metadata/unique-values?field=problem_type"
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "field": "problem_type",
  "values": ["stringing", "warping", "layer_separation", "bed_adhesion"]
}
```

---

### `GET /api/kb/examples/relevant`
–ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**
- `candidate_queries` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, string): –ö–∞–Ω–¥–∏–¥–∞—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤ (—Ä–∞–∑–¥–µ–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—è—Ç—ã–º–∏)
- `limit` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, int): –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–º–µ—Ä–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 8)
- `min_score` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, float): –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π score (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.3)

**–ü—Ä–∏–º–µ—Ä:**
```bash
curl "http://localhost:8000/api/kb/examples/relevant?limit=5&min_score=0.5"
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "examples": [
    {
      "query": "–£ –º–µ–Ω—è –ø–æ—è–≤–ª—è—é—Ç—Å—è –Ω–∏—Ç–æ—á–∫–∏ –º–µ–∂–¥—É –¥–µ—Ç–∞–ª—è–º–∏ –ø—Ä–∏ –ø–µ—á–∞—Ç–∏ PLA",
      "score": 0.95,
      "matched_articles": 3
    }
  ]
}
```

---

## üîß Swagger UI

–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É:

```
http://localhost:8000/docs
```

Swagger UI –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –≤—Å–µ endpoints
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å API –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- –í–∏–¥–µ—Ç—å —Å—Ö–µ–º—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ API –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `config.env`:

- `LLM_PROVIDER`: –ü—Ä–æ–≤–∞–π–¥–µ—Ä LLM (`ollama`, `openai`, `gemini`)
- `GEMINI_API_KEY`: API –∫–ª—é—á –¥–ª—è Gemini (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- `OPENAI_API_KEY`: API –∫–ª—é—á –¥–ª—è OpenAI (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- `QDRANT_HOST`: –•–æ—Å—Ç Qdrant (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `localhost`)
- `QDRANT_PORT`: –ü–æ—Ä—Ç Qdrant (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `6333`)
- `API_REQUEST_TIMEOUT`: –¢–∞–π–º–∞—É—Ç –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤ (—Å–µ–∫—É–Ω–¥—ã)

–ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º. [CONFIGURATION.md](./CONFIGURATION.md)

---

## üöÄ –ó–∞–ø—É—Å–∫ API

```bash
cd /mnt/ai/cnn/3dtoday
PYTHONPATH=. uvicorn backend.app.main:app --reload --host 0.0.0.0 --port 8000
```

API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `http://localhost:8000`

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

1. **–ö–æ–¥–∏—Ä–æ–≤–∫–∞**: –í—Å–µ –æ—Ç–≤–µ—Ç—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ UTF-8 —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫–∏—Ä–∏–ª–ª–∏—Ü—ã
2. **CORS**: –í–∫–ª—é—á–µ–Ω –¥–ª—è –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (–≤ production —Å–ª–µ–¥—É–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å)
3. **–¢–∞–π–º–∞—É—Ç—ã**: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –õ–æ–≥–∏ API –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ `logs/api.log`

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [ARCHITECTURE.md](./ARCHITECTURE.md) - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã
- [CONFIGURATION.md](./CONFIGURATION.md) - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- [IMAGE_DIAGNOSTIC_FEATURE.md](./IMAGE_DIAGNOSTIC_FEATURE.md) - –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
- [CONVERSATION_HISTORY.md](./CONVERSATION_HISTORY.md) - –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞
- [KB_MANAGEMENT.md](./KB_MANAGEMENT.md) - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π

